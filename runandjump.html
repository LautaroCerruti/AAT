<!doctype html> 
<html lang="en"> 
<head> 
    <meta charset="UTF-8" />
    <title>Cerruti & Garc√≠a Mata</title>
    <script src="http://cdn.jsdelivr.net/npm/phaser@3.1.1/dist/phaser.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>
<body>

<script type="text/javascript">

    var config = {
        type: Phaser.AUTO,
        width: 800,
        height: 600,
        physics: {
            default: 'arcade',
            arcade: {
                gravity: { y: 300 },
                debug: false
            }
        },
        scene: {
            preload: preload,
            create: create,
            update: update
        }
    };
    
    class Nene {
           constructor(){
                this.player;
                this.dbljmp=0;
           }
           corrizq (value){
               if(value){
                //this.player.setVelocityX(-160);
                if(this.player.body.velocity.x>-400) {
                    if(this.player.body.velocity.x>0) {
                        this.player.body.velocity.x=this.player.body.velocity.x-10;
                    }
                    else this.player.body.velocity.x=this.player.body.velocity.x-3;
                }
                this.player.anims.play('left', true);
               }
           }
           corrder (value){
               if(value){
                //this.player.setVelocityX(160);
                if(this.player.body.velocity.x<400) {
                    if(this.player.body.velocity.x<0) {
                        this.player.body.velocity.x=this.player.body.velocity.x+10;
                    }
                    else this.player.body.velocity.x=this.player.body.velocity.x+3;
                }
                this.player.anims.play('right', true);
               }
           }
           saltar(salto,touchingd){
               if(salto){
                if(touchingd){
                    this.player.setVelocityY(-250);
                    this.dbljmp=1;
                    } else if((this.player.body.velocity.y>-150) && this.dbljmp){
                        this.player.setVelocityY(-250);
                        this.dbljmp = 0;
                    }
               }
           }
           idle(value,value2){
            if(!(value || value2)) {
                if(this.player.body.velocity.x>0) {
                    if((this.player.body.velocity.x-5)<0) this.player.setVelocityX(0);
                    else this.player.body.velocity.x-=5;
                    }
                if(this.player.body.velocity.x<0) {
                    if((this.player.body.velocity.x+5)>0) this.player.setVelocityX(0);
                    else this.player.body.velocity.x+=5;
                    }
                this.player.anims.play('turn');
            }
           }
           parametros(sprite,bounce){
            jugador.player=sprite;
            jugador.player.setBounce(bounce);
            jugador.player.setCollideWorldBounds(true);
           }
    }
    var platforms;
    var cursors;
    let jugador = new Nene();
    var game = new Phaser.Game(config);

    function preload ()
    {
        this.load.image('sky', './assets/sky.png');
        this.load.image('ground', './assets/platform.png');
        this.load.spritesheet('dude', './assets/duude.png', { frameWidth: 30, frameHeight: 43 });
    }

    function create ()
    {
        this.add.image(400, 300, 'sky');

        platforms = this.physics.add.staticGroup();

        platforms.create(400, 568, 'ground').setScale(2).refreshBody();

        jugador.parametros(this.physics.add.sprite(500, 450, 'dude'),0.2);

        this.anims.create({
            key: 'left',
            frames: this.anims.generateFrameNumbers('dude', { start: 0, end: 5 }),
            frameRate: 10,
            repeat: -1
        });

        this.anims.create({
            key: 'turn',
            frames: [ { key: 'dude', frame: 6 } ],
            frameRate: 20
        });

        this.anims.create({
            key: 'right',
            frames: this.anims.generateFrameNumbers('dude', { start: 7, end: 12 }),
            frameRate: 10,
            repeat: -1
        });

        cursors = this.input.keyboard.createCursorKeys();

        this.physics.add.collider(jugador.player, platforms);

    }
    function update ()
    {
        jugador.corrizq(cursors.left.isDown);
        jugador.corrder(cursors.right.isDown);
        jugador.saltar(cursors.up.isDown,jugador.player.body.touching.down);
        jugador.idle(cursors.left.isDown,cursors.right.isDown);
    }
</script>

</body>
</html>
